<!-- templates/custom_admin/certificates/view_modal.html -->
<div class="certificate-view-content">
    <div class="row">
        <!-- Certificate Information -->
        <div class="col-md-6">
            <h6 class="text-muted mb-3"><i class="fas fa-certificate me-2"></i>Información del Certificado</h6>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Nombre del Sujeto</label>
                <p class="mb-0"><strong>{{ certificate.subject_name }}</strong></p>
            </div>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Número de Serie</label>
                <p class="mb-0 text-monospace">{{ certificate.serial_number }}</p>
            </div>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Emisor</label>
                <p class="mb-0">{{ certificate.issuer_name }}</p>
            </div>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Empresa</label>
                <p class="mb-0">
                    {% if certificate.company %}
                        <span class="badge bg-info">{{ certificate.company.business_name }}</span>
                    {% else %}
                        <span class="text-muted">Sin empresa asignada</span>
                    {% endif %}
                </p>
            </div>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Estado del Certificado</label>
                <p class="mb-0">
                    {% if certificate.is_expired %}
                        <span class="badge bg-danger">
                            <i class="fas fa-times-circle"></i> Expirado
                        </span>
                    {% elif certificate.days_until_expiry <= 30 and certificate.days_until_expiry > 0 %}
                        <span class="badge bg-warning">
                            <i class="fas fa-exclamation-triangle"></i> Por Expirar
                        </span>
                    {% else %}
                        <span class="badge bg-success">
                            <i class="fas fa-check-circle"></i> Activo
                        </span>
                    {% endif %}
                    
                    <span class="badge bg-secondary ms-2">{{ certificate.status }}</span>
                </p>
            </div>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Ambiente</label>
                <p class="mb-0">
                    <span class="badge bg-{% if certificate.environment == 'PRODUCTION' %}danger{% else %}warning{% endif %}">
                        {{ certificate.environment }}
                    </span>
                </p>
            </div>
        </div>
        
        <!-- Validity Information -->
        <div class="col-md-6">
            <h6 class="text-muted mb-3"><i class="fas fa-calendar-alt me-2"></i>Información de Validez</h6>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Válido Desde</label>
                <p class="mb-0">
                    <i class="fas fa-calendar-check text-success"></i>
                    {{ certificate.valid_from|date:"d/m/Y H:i" }}
                </p>
            </div>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Válido Hasta</label>
                <p class="mb-0">
                    <i class="fas fa-calendar-times text-danger"></i>
                    {{ certificate.valid_to|date:"d/m/Y H:i" }}
                </p>
            </div>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Días Restantes</label>
                <p class="mb-0">
                    {% if certificate.is_expired %}
                        <span class="text-danger fw-bold">Expirado hace {{ certificate.days_until_expiry|abs }} días</span>
                    {% elif certificate.days_until_expiry == 0 %}
                        <span class="text-danger fw-bold">Expira hoy</span>
                    {% elif certificate.days_until_expiry == 1 %}
                        <span class="text-warning fw-bold">Expira mañana</span>
                    {% elif certificate.days_until_expiry <= 30 %}
                        <span class="text-warning fw-bold">{{ certificate.days_until_expiry }} días restantes</span>
                    {% else %}
                        <span class="text-success fw-bold">{{ certificate.days_until_expiry }} días restantes</span>
                    {% endif %}
                </p>
            </div>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Fecha de Carga</label>
                <p class="mb-0">{{ certificate.created_at|date:"d/m/Y H:i" }}</p>
            </div>
            
            <div class="info-group mb-3">
                <label class="text-muted small">Fingerprint</label>
                <p class="mb-0"><code>{{ certificate.fingerprint }}</code></p>
            </div>
        </div>
    </div>
    
    <hr>
    
    <!-- Technical Details -->
    <div class="row">
        <div class="col-12">
            <h6 class="text-muted mb-3"><i class="fas fa-info-circle me-2"></i>Detalles Técnicos</h6>
            
            <div class="technical-details bg-light p-3 rounded">
                <p class="mb-2"><strong>CN (Common Name):</strong> {{ certificate.subject_name }}</p>
                <p class="mb-2"><strong>Autoridad Certificadora:</strong> {{ certificate.issuer_name }}</p>
                <p class="mb-2"><strong>Serial Completo:</strong></p>
                <pre class="bg-white p-2 rounded text-monospace small">{{ certificate.serial_number }}</pre>
                
                {% if certificate.certificate_file %}
                <p class="mb-0">
                    <strong>Archivo:</strong> 
                    <code>{{ certificate.certificate_file.name }}</code>
                </p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Progress Bar -->
    <hr>
    <div class="row">
        <div class="col-12">
            <h6 class="text-muted mb-3"><i class="fas fa-chart-line me-2"></i>Progreso de Validez</h6>
            {% if not certificate.is_expired %}
                <div class="progress" style="height: 25px;">
                    <div class="progress-bar {% if certificate.days_until_expiry <= 30 %}bg-warning{% else %}bg-success{% endif %}" 
                         role="progressbar" 
                         style="width: 70%"
                         aria-valuenow="70" 
                         aria-valuemin="0" 
                         aria-valuemax="100">
                        Válido por {{ certificate.days_until_expiry }} días más
                    </div>
                </div>
            {% else %}
                <div class="progress" style="height: 25px;">
                    <div class="progress-bar bg-danger" role="progressbar" style="width: 100%">
                        Certificado Expirado
                    </div>
                </div>
            {% endif %}
            <small class="text-muted">
                Válido desde {{ certificate.valid_from|date:"d/m/Y" }} hasta {{ certificate.valid_to|date:"d/m/Y" }}
            </small>
        </div>
    </div>
    
    <div class="modal-footer px-0 pb-0 mt-4">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-1"></i>Cerrar
        </button>
        {% if not certificate.is_expired %}
        <button class="btn btn-warning btn-validate-from-view" data-cert-id="{{ certificate.id }}">
            <i class="fas fa-check me-1"></i>Validar Certificado
        </button>
        {% endif %}
    </div>
</div>

<style>
.info-group {
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 0.25rem;
}

.info-group label {
    display: block;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.25rem;
}

.certificate-view-content {
    padding: 0.5rem;
}

.technical-details {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

.text-monospace {
    font-family: 'Courier New', monospace;
}

pre {
    white-space: pre-wrap;
    word-break: break-all;
    margin-bottom: 0;
    max-width: 100%;
    overflow-x: auto;
}
</style>

<script>
// Handler para el botón de validar desde la vista
$('.btn-validate-from-view').on('click', function(e) {
    e.preventDefault();
    var certId = $(this).data('cert-id');
    
    // Cerrar el modal actual
    bootstrap.Modal.getInstance(document.getElementById('certificateModal')).hide();
    
    // Trigger el click en el botón de validar
    setTimeout(function() {
        $('.btn-validate[data-cert-id="' + certId + '"]').click();
    }, 300);
});
</script>